import{t as Y,i as D,I as M,J as $}from"./index-Dmxrvkb1.js";import{B as z}from"./botTypes-_WzAd8ij.js";import{C as R}from"./itemTypes-D0s_vHyk.js";var H={exports:{}};H.exports;(function(e){var i=function(){var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",y={};function C(o,s){if(!y[o]){y[o]={};for(var a=0;a<o.length;a++)y[o][o.charAt(a)]=a}return y[o][s]}var l={compressToBase64:function(o){if(o==null)return"";var s=l._compress(o,6,function(a){return n.charAt(a)});switch(s.length%4){default:case 0:return s;case 1:return s+"===";case 2:return s+"==";case 3:return s+"="}},decompressFromBase64:function(o){return o==null?"":o==""?null:l._decompress(o.length,32,function(s){return C(n,o.charAt(s))})},compressToUTF16:function(o){return o==null?"":l._compress(o,15,function(s){return r(s+32)})+" "},decompressFromUTF16:function(o){return o==null?"":o==""?null:l._decompress(o.length,16384,function(s){return o.charCodeAt(s)-32})},compressToUint8Array:function(o){for(var s=l.compress(o),a=new Uint8Array(s.length*2),d=0,t=s.length;d<t;d++){var x=s.charCodeAt(d);a[d*2]=x>>>8,a[d*2+1]=x%256}return a},decompressFromUint8Array:function(o){if(o==null)return l.decompress(o);for(var s=new Array(o.length/2),a=0,d=s.length;a<d;a++)s[a]=o[a*2]*256+o[a*2+1];var t=[];return s.forEach(function(x){t.push(r(x))}),l.decompress(t.join(""))},compressToEncodedURIComponent:function(o){return o==null?"":l._compress(o,6,function(s){return c.charAt(s)})},decompressFromEncodedURIComponent:function(o){return o==null?"":o==""?null:(o=o.replace(/ /g,"+"),l._decompress(o.length,32,function(s){return C(c,o.charAt(s))}))},compress:function(o){return l._compress(o,16,function(s){return r(s)})},_compress:function(o,s,a){if(o==null)return"";var d,t,x={},A={},S="",P="",p="",g=2,f=3,h=2,I=[],u=0,m=0,v;for(v=0;v<o.length;v+=1)if(S=o.charAt(v),Object.prototype.hasOwnProperty.call(x,S)||(x[S]=f++,A[S]=!0),P=p+S,Object.prototype.hasOwnProperty.call(x,P))p=P;else{if(Object.prototype.hasOwnProperty.call(A,p)){if(p.charCodeAt(0)<256){for(d=0;d<h;d++)u=u<<1,m==s-1?(m=0,I.push(a(u)),u=0):m++;for(t=p.charCodeAt(0),d=0;d<8;d++)u=u<<1|t&1,m==s-1?(m=0,I.push(a(u)),u=0):m++,t=t>>1}else{for(t=1,d=0;d<h;d++)u=u<<1|t,m==s-1?(m=0,I.push(a(u)),u=0):m++,t=0;for(t=p.charCodeAt(0),d=0;d<16;d++)u=u<<1|t&1,m==s-1?(m=0,I.push(a(u)),u=0):m++,t=t>>1}g--,g==0&&(g=Math.pow(2,h),h++),delete A[p]}else for(t=x[p],d=0;d<h;d++)u=u<<1|t&1,m==s-1?(m=0,I.push(a(u)),u=0):m++,t=t>>1;g--,g==0&&(g=Math.pow(2,h),h++),x[P]=f++,p=String(S)}if(p!==""){if(Object.prototype.hasOwnProperty.call(A,p)){if(p.charCodeAt(0)<256){for(d=0;d<h;d++)u=u<<1,m==s-1?(m=0,I.push(a(u)),u=0):m++;for(t=p.charCodeAt(0),d=0;d<8;d++)u=u<<1|t&1,m==s-1?(m=0,I.push(a(u)),u=0):m++,t=t>>1}else{for(t=1,d=0;d<h;d++)u=u<<1|t,m==s-1?(m=0,I.push(a(u)),u=0):m++,t=0;for(t=p.charCodeAt(0),d=0;d<16;d++)u=u<<1|t&1,m==s-1?(m=0,I.push(a(u)),u=0):m++,t=t>>1}g--,g==0&&(g=Math.pow(2,h),h++),delete A[p]}else for(t=x[p],d=0;d<h;d++)u=u<<1|t&1,m==s-1?(m=0,I.push(a(u)),u=0):m++,t=t>>1;g--,g==0&&(g=Math.pow(2,h),h++)}for(t=2,d=0;d<h;d++)u=u<<1|t&1,m==s-1?(m=0,I.push(a(u)),u=0):m++,t=t>>1;for(;;)if(u=u<<1,m==s-1){I.push(a(u));break}else m++;return I.join("")},decompress:function(o){return o==null?"":o==""?null:l._decompress(o.length,32768,function(s){return o.charCodeAt(s)})},_decompress:function(o,s,a){var d=[],t=4,x=4,A=3,S="",P=[],p,g,f,h,I,u,m,v={val:a(0),position:s,index:1};for(p=0;p<3;p+=1)d[p]=p;for(f=0,I=Math.pow(2,2),u=1;u!=I;)h=v.val&v.position,v.position>>=1,v.position==0&&(v.position=s,v.val=a(v.index++)),f|=(h>0?1:0)*u,u<<=1;switch(f){case 0:for(f=0,I=Math.pow(2,8),u=1;u!=I;)h=v.val&v.position,v.position>>=1,v.position==0&&(v.position=s,v.val=a(v.index++)),f|=(h>0?1:0)*u,u<<=1;m=r(f);break;case 1:for(f=0,I=Math.pow(2,16),u=1;u!=I;)h=v.val&v.position,v.position>>=1,v.position==0&&(v.position=s,v.val=a(v.index++)),f|=(h>0?1:0)*u,u<<=1;m=r(f);break;case 2:return""}for(d[3]=m,g=m,P.push(m);;){if(v.index>o)return"";for(f=0,I=Math.pow(2,A),u=1;u!=I;)h=v.val&v.position,v.position>>=1,v.position==0&&(v.position=s,v.val=a(v.index++)),f|=(h>0?1:0)*u,u<<=1;switch(m=f){case 0:for(f=0,I=Math.pow(2,8),u=1;u!=I;)h=v.val&v.position,v.position>>=1,v.position==0&&(v.position=s,v.val=a(v.index++)),f|=(h>0?1:0)*u,u<<=1;d[x++]=r(f),m=x-1,t--;break;case 1:for(f=0,I=Math.pow(2,16),u=1;u!=I;)h=v.val&v.position,v.position>>=1,v.position==0&&(v.position=s,v.val=a(v.index++)),f|=(h>0?1:0)*u,u<<=1;d[x++]=r(f),m=x-1,t--;break;case 2:return P.join("")}if(t==0&&(t=Math.pow(2,A),A++),d[m])S=d[m];else if(m===x)S=g+g.charAt(0);else return null;P.push(S),d[x++]=g+S.charAt(0),t--,g=S,t==0&&(t=Math.pow(2,A),A++)}}};return l}();e!=null&&(e.exports=i)})(H);var V=H.exports;const ue=Y(V),b=10,ee=95,ie=100,ne=1e5,ge=new Map([["Huge",30],["Large",10],["Medium",0],["Small",-10],["Tiny",-30]]),L=["Phase Wall","Vortex Field Projector","7V-RTL'S Ultimate Field","Force Field","Imp. Force Field","Adv. Force Field","Exp. Force Field","Shield Generator","Imp. Shield Generator","Adv. Shield Generator","Exp. Shield Generator","Stasis Bubble","Stasis Trap","Remote Shield","Imp. Remote Shield","Remote Force Field","Imp. Remote Force Field","Energy Mantle","Imp. Energy Mantle","AEGIS Remote Shield"],U=new Map([["Remote Shield",.75],["Stasis Trap",.75],["Phase Wall",.5],["Remote Force Field",.5],["Stasis Bubble",.5]]),G=[4,6,8,10],pe=[.2,.3,.4,.5],me=60,ve=70,K=[5,6,8,12],he=[2,3,4,6],ye=new Map([["No Special",{bonus:0,recoilNegated:!1,tus:0}],["In Siege Mode",{bonus:15,recoilNegated:!0,tus:0}],["In High Siege Mode",{bonus:25,recoilNegated:!0,tus:0}],["In Martial Mode",{bonus:0,recoilNegated:!0,tus:0}],["Entering Siege Mode",{bonus:15,recoilNegated:!0,tus:700}],["Entering High Siege Mode",{bonus:25,recoilNegated:!0,tus:700}],["Entering Martial Mode",{bonus:0,recoilNegated:!0,tus:300}]]),re={"Wide (10)":10,"Intermediate (30)":30,"Narrow (50)":50,"Fine (100)":100},Z={1:200,2:300,3:325,4:350,5:375,6:400};function J(e){const i=e.botState;if(i.destroyedParts.length===0)return;const r=i.destroyedParts.splice(M(0,i.destroyedParts.length-1),1)[0];if(i.parts.push(r),i.armorAnalyzedCoverage+=r.armorAnalyzedCoverage,i.armorAnalyzedShieldedCoverage+=r.armorAnalyzedShieldedCoverage,i.armorAnalyzedSiegedCoverage+=r.armorAnalyzedSiegedCoverage,i.siegedCoverage+=r.siegedCoverage,i.totalCoverage+=r.coverage,r.resistances!==void 0)for(const n of Object.keys(r.resistances))n in i.resistances&&(i.resistances[n]+=r.resistances[n]);r.integrity=r.def.integrity,w(e)}function F(e,i,r,n,c,y,C,l,o,s,a,d,t,x){const A=[],S=Math.trunc(r/n);if(y)for(let f=0;f<n;f++)A.push({armorAnalyzed:!1,critical:void 0,coreBonus:0,damageType:a,disruptChance:0,forceCore:!1,guided:x,originalDamage:S,penetrate:!1,realDamage:0,salvage:d,spectrum:0});else for(let f=0;f<n;f++)A.push({armorAnalyzed:C,coreBonus:e.offensiveState.coreAnalyzerChance,critical:c,damageType:a,disruptChance:l,forceCore:!1,guided:x,originalDamage:S,penetrate:M(0,100)<=t,realDamage:0,salvage:d,spectrum:o});const P=T(i.defensiveState.damageReduction);let p=1,g=0;if(P!==void 0)p=P.reduction;else{const f=T(i.defensiveState.hardlightGenerator);f!==void 0&&(g=f.reduction)}if(P!==void 0&&P.remote)for(const f of A)f.realDamage=f.originalDamage-Math.trunc(f.originalDamage*(1-p))-g;else for(const f of A)f.realDamage=Math.trunc(f.originalDamage*p)-g;i.salvage+=d;for(const f of A){if(f.realDamage===0)return;if(W(e,f.coreBonus,f.realDamage,f.damageType,f.critical,s,!1,f.forceCore,f.disruptChance,f.spectrum,f.armorAnalyzed,f.penetrate,f.guided),a==="Electromagnetic"){const h=T(i.defensiveState.corruptionIgnore),I=c===R.Corrupt&&!i.immunities.includes(z.Criticals);if(h===void 0||M(0,99)>=h.chance){const u=I?1.5:M(50,150)/100,m=f.originalDamage*u;q(e,m)}}}}function W(e,i,r,n,c,y,C,l,o,s,a,d,t){const{part:x,partIndex:A}=te(e.botState,i,n,C,l,a);E(e,r,n,c,o,s,y,C,d,t,x,A)}function q(e,i){const r=e.botState;let n=T(r.defensiveState.corruptionPrevent);for(;i>0&&n!==void 0;){const c=Math.ceil(n.part.integrity/2);if(c<i)n.part.integrity-=i*=2,i=0;else{r.defensiveState.corruptionPrevent.shift();const y=r.parts.indexOf(n.part);k(e,!1,y,n.part,0,"Entropic","Integrity"),n=T(r.defensiveState.corruptionPrevent),i-=c}}r.corruption+=i}function E(e,i,r,n,c,y,C,l,o,s,a,d){const t=e.botState;function x(g){return g===R.Destroy||g===R.Smash}if(n!==void 0&&(t.immunities.includes(z.Criticals)||T(t.defensiveState.critImmunity)!==void 0)&&(n=void 0),n===R.Meltdown&&!t.immunities.includes(z.Meltdown)){t.coreIntegrity=0,t.heat=Math.max(t.heat,300);return}else if(n===R.Intensify)i*=2;else if(n===R.Impale)i*=2,e.tus+=100;else if(n===R.Detonate){let g;for(g=0;g<t.parts.length&&t.parts[g].def.slot!=="Power";g++);if(g<t.parts.length){const f=t.parts[g];if(k(e,!1,g,f,0,"Entropic","Integrity"),X(e,f),g===d)return}}else((n===R.Sever||n===R.Sunder)&&t.immunities.includes(z.Dismemberment)||n===R.Phase&&(t.immunities.includes(z.Coring)||j(t,"Core")!==void 0))&&(n=void 0);if(a===void 0){const g=l?void 0:j(t,"Core");if((n===R.Destroy||n==R.Phase||n==R.Smash||n==R.Sunder||n==R.Sever)&&(t.immunities.includes(z.Coring)||g!==void 0)&&(n=void 0),g!=null){const f=Math.trunc(g.reduction*i);if(g.part.integrity-=f,g.part.integrity<=0){const h=t.parts.indexOf(g.part);k(e,!1,h,g.part,0,"Entropic","Integrity")}i=i-f}if(n===R.Destroy||n===R.Smash?t.coreIntegrity=0:t.coreIntegrity-=i,t.coreIntegrity===0)return;if(!t.immunities.includes(z.Disruption)&&M(0,99)<c/2&&(t.coreDisrupted=!0),n===R.Sever||n===R.Sunder){const f=n===R.Sunder?M(1,2):1;for(let h=0;h<f;h++){const{part:I,partIndex:u}=_(t,void 0);I===void 0||j(t,I.def.slot)!==void 0||I.def.size>1||(I.integrity-=Math.trunc(I.def.integrity*M(5,25)/100),k(e,!1,u,I,0,"Phasic","CriticalRemove"))}return}else if(n===R.Blast){const{part:f,partIndex:h}=_(t,void 0);if(f===void 0||j(t,f.def.slot)!==void 0)return;f.def.size===1?(E(e,i,"Phasic",void 0,0,0,!1,!1,!1,!1,f,h),f.integrity>0&&!t.immunities.includes(z.Dismemberment)&&k(e,!1,h,f,0,"Phasic","CriticalRemove")):E(e,i,"Phasic",void 0,0,0,!1,!1,!1,!1,f,h)}else if(n===R.Phase){const{part:f,partIndex:h}=_(t,void 0);E(e,i,"Phasic",void 0,0,0,!1,!1,!1,!1,f,h)}return}const A=a.def.type==="Protection"||l?void 0:j(t,a.def.slot);A!==void 0&&x(n)&&(n=void 0);const S=a.def.slot==="Power"&&M(0,99)<y;if((x(n)&&a.protection||t.sieged&&a.def.type==="Treads"&&a.def.siege!==void 0)&&(n=void 0,i=Math.trunc(1.2*i)),a.selfDamageReduction!==0?i=Math.trunc(i*a.selfDamageReduction):a.def.type==="Treads"&&a.def.siege!==void 0&&t.sieged?i=Math.trunc(i*(a.def.siege==="High Siege"?.5:.75)):a.def.type==="Leg"&&a.def.shield&&t.shielded&&(!o&&!s&&M(0,1)===1?i=0:i=Math.trunc(i*.5)),A!=null){const g=Math.trunc(A.reduction*i);if(A.part.integrity-=g,A.part.integrity<=0){const f=t.parts.indexOf(A.part);k(e,!1,f,A.part,0,"Entropic","Integrity")}i=i-g}const P=a.integrity<=i||x(n)||S;if(!P&&(n===R.Sever||n===R.Sunder)&&a.def.size===1&&A===void 0&&(P||k(e,!1,d,a,0,"Slashing","CriticalRemove")),P){const g=n===R.Smash?i:i-a.integrity;k(e,C,d,a,g,r,"Integrity")}else a.integrity-=i;const p=d;if(n===R.Blast){const{part:g,partIndex:f}=_(t,P?p:void 0);if(g===void 0||A!==void 0)return;g.def.size===1?(E(e,i,"Phasic",void 0,0,0,!1,!1,!1,!1,g,f),g.integrity>0&&!t.immunities.includes(z.Dismemberment)&&k(e,!1,f,g,0,"Phasic","CriticalRemove")):E(e,i,"Phasic",void 0,0,0,!1,!1,!1,!1,g,f)}else n===R.Phase&&E(e,i,"Phasic",void 0,0,0,!1,!1,!1,!1,void 0,-1);S&&X(e,a)}function oe(e){const i={};for(const n of Object.keys(e.resistances))i[n]=e.resistances[n];const r={armorAnalyzedCoverage:e.armorAnalyzedCoverage,armorAnalyzedShieldedCoverage:e.armorAnalyzedShieldedCoverage,armorAnalyzedSiegedCoverage:e.armorAnalyzedSiegedCoverage,behavior:e.behavior,coreCoverage:e.coreCoverage,coreDisrupted:e.coreDisrupted,coreIntegrity:e.coreIntegrity,corruption:e.corruption,def:e.def,defensiveState:void 0,destroyedParts:[],dormant:e.dormant,externalDamageReduction:e.externalDamageReduction,heat:0,immunities:e.immunities,initialCoreIntegrity:e.initialCoreIntegrity,parts:e.parts.map(n=>({armorAnalyzedShieldedCoverage:n.armorAnalyzedShieldedCoverage,armorAnalyzedSiegedCoverage:n.armorAnalyzedSiegedCoverage,armorAnalyzedCoverage:n.armorAnalyzedCoverage,coverage:n.coverage,def:n.def,integrity:n.integrity,initialIndex:n.initialIndex,protection:n.protection,selfDamageReduction:n.selfDamageReduction,shieldedCoverage:n.shieldedCoverage,siegedCoverage:n.siegedCoverage})),partRegen:e.partRegen,coreRegen:e.coreRegen,resistances:i,running:e.running,runningEvasion:e.runningEvasion,runningMomentum:e.runningMomentum,salvage:e.salvage,shielded:e.shielded,shieldedCoverage:e.shieldedCoverage,sieged:e.sieged,siegedCoverage:e.siegedCoverage,superfortressRegen:e.superfortressRegen,tusToShield:e.tusToShield,tusToSiege:e.tusToSiege,totalCoverage:e.totalCoverage};return r.defensiveState=Q(r.parts,r.externalDamageReduction,e.dormant),r}function X(e,i){if(i.def.slot!=="Power")return;const r=i.def;if(r.explosionDamageMax>0&&r.explosionType!==void 0){const n=M(r.explosionDamageMin,r.explosionDamageMax),c=M(r.minChunks??0,r.maxChunks??0),y=Math.trunc(n/c);e.botState.salvage+=r.explosionSalvage;for(let C=0;C<c;C++)W(e,0,y,r.explosionType,void 0,!0,!1,!1,r.explosionDisruption,le(r.explosionSpectrum),!1,!1,!1)}}function N(e,i,r){return r in e.resistances?Math.trunc(i*(1-e.resistances[r]/100)):i}function Q(e,i,r){const n={antimissile:[],avoid:[],corruptionIgnore:[],corruptionPrevent:[],corruptionReduce:[],critImmunity:[],damageReduction:[],hardlightGenerator:[],rangedAvoid:[],shieldings:{Core:[],"N/A":[],Power:[],Propulsion:[],Utility:[],Weapon:[]}};for(const c of e)if(D(c.def,!r,"AntimissileChance"))n.antimissile.push({chance:c.def.specialProperty.trait.chance,part:c});else if(D(c.def,!r,"ReactionControlSystem"))n.avoid.push({chance:c.def.specialProperty.trait.chance,part:c});else if(D(c.def,!r,"CorruptionIgnore"))n.corruptionIgnore.push({chance:c.def.specialProperty.trait.chance,part:c});else if(D(c.def,!r,"CorruptionPrevent"))n.corruptionPrevent.push({part:c});else if(D(c.def,!r,"CorruptionReduce"))n.corruptionReduce.push({amount:c.def.specialProperty.trait.amount,part:c});else if(D(c.def,!r,"CriticalImmunity"))n.critImmunity.push({part:c});else if(D(c.def,!r,"DamageReduction"))n.damageReduction.push({reduction:c.def.specialProperty.trait.multiplier,remote:c.def.specialProperty.trait.remote,part:c});else if(D(c.def,!r,"DamageResists"))c.resistances=c.def.specialProperty.trait.resists;else if(D(c.def,!r,"HardlightGenerator"))n.hardlightGenerator.push({reduction:c.def.specialProperty.trait.amount,part:c});else if(D(c.def,!r,"RangedAvoid"))n.rangedAvoid.push({avoid:c.def.specialProperty.trait.avoid,part:c});else if(D(c.def,!r,"SelfReduction"))c.selfDamageReduction=c.def.specialProperty.trait.shielding;else if(D(c.def,!r,"Shielding")){const y=c.def.specialProperty.trait;n.shieldings[y.slot].push({reduction:y.shielding,part:c})}if(U.has(i)){const c=U.get(i)||1,y=i.includes("Remote");if(n.damageReduction.length===0)n.damageReduction.push({reduction:c,remote:y,part:{armorAnalyzedShieldedCoverage:0,armorAnalyzedSiegedCoverage:0,armorAnalyzedCoverage:0,coverage:0,def:void 0,integrity:1,initialIndex:0,protection:!1,selfDamageReduction:0,shieldedCoverage:0,siegedCoverage:0}});else{const C=L.indexOf(n.damageReduction[0].part.def.name);L.indexOf(i)<C?n.damageReduction.unshift({reduction:c,remote:y,part:{armorAnalyzedCoverage:0,armorAnalyzedShieldedCoverage:0,armorAnalyzedSiegedCoverage:0,coverage:0,def:void 0,integrity:1,initialIndex:0,protection:!1,selfDamageReduction:0,shieldedCoverage:0,siegedCoverage:0}}):n.damageReduction.push({remote:y,reduction:c,part:{armorAnalyzedCoverage:0,armorAnalyzedShieldedCoverage:0,armorAnalyzedSiegedCoverage:0,coverage:0,def:void 0,initialIndex:0,integrity:1,protection:!1,selfDamageReduction:0,shieldedCoverage:0,siegedCoverage:0}})}}return n}function k(e,i,r,n,c,y,C){const l=e.botState;if(l.parts.splice(r,1),l.armorAnalyzedCoverage-=n.armorAnalyzedCoverage,l.armorAnalyzedShieldedCoverage-=n.armorAnalyzedShieldedCoverage,l.armorAnalyzedSiegedCoverage-=n.armorAnalyzedSiegedCoverage,l.siegedCoverage-=n.siegedCoverage,l.shieldedCoverage-=n.shieldedCoverage,l.totalCoverage-=n.coverage,n.resistances!==void 0)for(const o of Object.keys(n.resistances))o in l.resistances&&(l.resistances[o]-=n.resistances[o]);if(c>0&&!n.protection&&i&&W(e,0,c,y,void 0,!0,!0,!1,0,0,!1,!1,!1),y==="Impact"){let o=M(50,150);o=N(l,o,"Electromagnetic"),q(e,o)}C==="CriticalRemove"&&n.integrity>0&&n.def.type!=="Processor"&&n.def.type!=="Hackware"&&(e.lootState.items[n.initialIndex].numDrops+=1,e.lootState.items[n.initialIndex].totalCritRemoves+=1,e.lootState.items[n.initialIndex].totalIntegrity+=n.integrity,e.lootState.items[n.initialIndex].integrityDrops.push(n.integrity)),n.integrity=0,w(e),l.destroyedParts.push(n)}function T(e){let i;for(;e.length>0;)if(e[0].part.integrity>0){i=e[0];break}else e.shift();return i}function te(e,i,r,n,c,y){let C,l=-1;if(c)return{part:C,partIndex:l};if(r==="Impact"){let o=M(0,e.parts.map(s=>s.def.size).reduce($,0));for(let s=0;s<e.parts.length;s++){if(o<e.parts[s].def.size){l=s;break}o-=e.parts[s].def.size}l>=0&&(C=e.parts[l])}else if(n){const o=e.parts.filter(s=>s.protection&&s.coverage>0);if(o.length>0){let s=M(0,o.reduce((a,d)=>a+d.coverage,0));for(let a=0;a<o.length;a++)if(s-=o[a].coverage,s<0){C=o[a];break}l=e.parts.indexOf(C)}}if(C===void 0&&r!=="Impact"){let o;if(y?e.sieged?o=e.armorAnalyzedSiegedCoverage:e.shielded?o=e.armorAnalyzedShieldedCoverage:o=e.armorAnalyzedCoverage:e.sieged?o=e.siegedCoverage:e.shielded?o=e.shieldedCoverage:o=e.totalCoverage,r=="Piercing"&&(i+=8),i>0){o-=e.coreCoverage;const a=Math.min(e.coreCoverage/e.totalCoverage+i/100,.999),d=e.totalCoverage*a;o+=d}let s=M(0,o-1);for(l=0;l<e.parts.length;l++)if(y?e.sieged?s-=e.parts[l].armorAnalyzedSiegedCoverage:e.shielded?s-=e.parts[l].armorAnalyzedShieldedCoverage:s-=e.parts[l].armorAnalyzedCoverage:e.sieged?s-=e.parts[l].siegedCoverage:e.shielded?s-=e.parts[l].shieldedCoverage:s-=e.parts[l].coverage,s<0){C=e.parts[l];break}}return{part:C,partIndex:l}}function _(e,i){let r=M(0,e.parts.length-1-(i===void 0?0:1));return i!==void 0&&i>0&&r>=i&&(r+=1),r>=e.parts.length?{part:void 0,partIndex:-1}:{part:e.parts[r],partIndex:r}}function se(e,i){let r=0;return e.recoil!==void 0&&(r+=e.recoil,r-=i),Math.max(r,0)}function Ce(e,i){let r;if(e.length===0)return 0;e.length in Z?r=Z[e.length]:r=400;for(const n of e)r+=n.delay??0;return r*=i,Math.trunc(Math.max(25,r))}function j(e,i){return T(e.defensiveState.shieldings[i])}function B(e){let i=e.corruption;for(const r of e.defensiveState.corruptionReduce)r.part.integrity>=0&&(i-=r.amount);return i}const ae={Kill:{volleyEndCondition:function(e){return e.coreIntegrity<=0||B(e)>=100},projectileEndCondition:function(e){return e.coreIntegrity<=0}},"Kill or Core Disrupt":{projectileEndCondition:function(e){return e.coreIntegrity<=0},volleyEndCondition:function(e){return e.coreIntegrity<=0||B(e)>=100||e.coreDisrupted}},"Kill or No Power":{projectileEndCondition:function(e){return e.coreIntegrity<=0},volleyEndCondition:function(e){return e.coreIntegrity<=0||B(e)>=100||e.parts.every(i=>i.def.slot!="Power")}},"Kill or No Weapons":{projectileEndCondition:function(e){return e.coreIntegrity<=0},volleyEndCondition:function(e){return e.coreIntegrity<=0||B(e)>=100||e.parts.every(i=>i.def.slot!="Weapon")}},"Kill or No TNC":{projectileEndCondition:function(e){return e.coreIntegrity<=0},volleyEndCondition:function(e){return e.coreIntegrity<=0||B(e)>=100||e.parts.every(i=>i.def.name!="Transport Network Coupler")}},Tele:{projectileEndCondition:function(e){return e.coreIntegrity<=0},volleyEndCondition:function(e){return e.coreIntegrity<=e.initialCoreIntegrity*.8||e.parts.filter(i=>i.def.slot==="Weapon").length===1||e.parts.filter(i=>i.def.slot==="Propulsion").length===1}}};function Ae(e){const i=oe(e.initialBotState);e.botState=i;const r=e.offensiveState;let n=0,c=!1,y=!1,C=Number.MAX_SAFE_INTEGER,l=0;e.tus=0,e.actionNum=0,w(e);const o=ae[e.endCondition];r.sneakAttack=r.sneakAttackStrategy==="All"||r.sneakAttackStrategy==="First Only",r.momentum.current=r.momentum.bonus+r.momentum.initial;let s=!1;for(;!s;){const d=Math.trunc(l/100),t=Math.trunc(e.tus/100),x=i.coreRegen*(t-d);i.coreIntegrity=Math.min(i.initialCoreIntegrity,i.coreIntegrity+x);const A=i.partRegen*(t-d);for(const p of i.parts)p.integrity=Math.min(p.integrity+A,p.def.integrity);if(i.partRegen>0){const p=[...Array(t-d)].map((g,f)=>f+d).filter(g=>g%10===0).length;for(let g=0;g<p;g++)J(e)}i.superfortressRegen&&t<=i.superfortressRegen.nextRegenAttempt&&(J(e),i.superfortressRegen.nextRegenAttempt+=M(5,25)),t>=C&&!y?(i.dormant=!1,i.defensiveState=Q(i.parts,i.externalDamageReduction,i.dormant),y=!0):!c&&i.behavior==="Unpowered 10 Turns"&&i.coreIntegrity!=i.initialCoreIntegrity&&(C=t+10,c=!0),n+=1;let S=r.volleyTime;if(r.melee){s=O(e,e.weapons[0],o.projectileEndCondition),e.actionNum+=1,e.actionNum<=2&&w(e);for(let p=1;p<e.weapons.length&&!s;p++)M(0,99)<r.followupChances[p-1]&&(s=O(e,e.weapons[p],o.projectileEndCondition),S+=.5*e.weapons[p].delay);S*=r.volleyTimeModifier,n===1&&(r.sneakAttackStrategy==="First Only"&&(r.sneakAttack=!1),r.momentum.current=r.momentum.bonus)}else{let p=!0;for(const g of e.weapons){if(s=O(e,g,o.projectileEndCondition),s)break;p&&(p=!1,e.actionNum+=1,e.actionNum<=2&&w(e))}}if(n>=ne)return!1;r.ramming&&(S=Math.max(100,r.speed)),l=e.tus,e.tus+=S;let P=!1;!r.melee&&l<r.specialBonus.tus&&e.tus>=r.specialBonus.tus&&(P=!0),l<i.tusToShield&&e.tus>=i.tusToShield&&i.behavior==="Shield/Fight"&&i.parts.find(p=>p.def.type==="Leg"&&p.def.shield)!==void 0&&(i.shielded=!0),l<i.tusToSiege&&e.tus>=i.tusToSiege&&i.behavior==="Siege/Fight"&&i.parts.find(p=>p.def.type==="Treads"&&p.def.siege!==void 0)!==void 0&&(i.sieged=!0,P=!0),i.behavior==="Run When Hit"&&i.runningMomentum<3&&(i.running=!0,i.runningMomentum=Math.min(Math.trunc(e.tus/i.def.speed),3)),P&&w(e),s=o.volleyEndCondition(i)}n in e.killVolleys?e.killVolleys[n]+=1:e.killVolleys[n]=1,e.tus in e.killTus?e.killTus[e.tus]+=1:e.killTus[e.tus]=1;for(const d of i.parts)if(d.integrity>0){const t=e.lootState.items[d.initialIndex];let x=M(0,99)<d.integrity/d.def.integrity*100/2+i.salvage;const A=B(i);x&&A>0&&M(0,99)<A-d.def.integrity&&(t.totalFried+=1,x=!1),x&&i.heat>0&&M(0,99)<(i.heat-d.def.integrity)/4&&(t.totalMelted+=1,x=!1),x&&(t.totalIntegrity+=d.integrity,t.integrityDrops.push(d.integrity),t.numDrops+=1,M(0,99)<A&&(t.totalCorruptionPercent+=M(1,Math.min(10*A/100,15))))}e.lootState.numKills+=1;let a=M(i.def.salvageLow,i.def.salvageHigh);return a+=i.salvage,a=Math.max(0,a),a=Math.min(a,i.def.salvageHigh),e.lootState.matterDrop+=a,!0}function O(e,i,r){const n=e.botState,c=e.offensiveState;if(c.ramming){const y=100/e.offensiveState.speed*100;let C=((10+i.def.mass)/5+1)*(y/100)*Math.max(e.offensiveState.momentum.current,1);C=Math.min(100,C);let l=M(0,C);return l=N(n,l,"Impact"),l>0&&F(e,n,l,1,void 0,!1,!1,0,0,!0,"Impact",3,0,i.def.waypoints!==void 0),r(n)}if(!c.melee&&c.corruption>0&&M(0,1e3)<c.corruption*2)return!1;for(let y=0;y<i.numProjectiles;y++){let C=c.melee&&c.sneakAttack||M(0,99)<i.accuracy;if(C&&i.isMissile){const l=T(n.defensiveState.antimissile);if(l!=null){const o=l.chance,s=Math.min(4,c.distance);for(let a=0;a<s;a++)if(M(0,99)<o){C=!1;break}}}if(C){if(i.def.type==="Ballistic Cannon"&&(i.def.salvage??0)<-2&&(e.lootState.matterBlasted+=Math.trunc(M(0,-i.def.salvage))),i.damageType!=null){let l=M(i.damageMin,i.damageMax);if(i.overloaded&&(l=Math.trunc(l*2)),c.melee&&c.momentum.current>0){const d=100/c.speed*100;let t=c.momentum.current*d/1200*40;t=Math.trunc(t),t=Math.max(1,t),t=Math.min(40,t),i.damageType==="Piercing"&&(t*=2),t=t/100+1,l=Math.trunc(t*l)}(c.melee&&c.sneakAttack||n.dormant)&&(l*=2),c.analysis&&(l=Math.trunc(1.1*l)),i.accelerated&&(l=Math.trunc(c.chargerBonus*l)),l=N(n,l,i.damageType);const o=M(0,99)<c.armorAnalyzerChance,s=M(0,99)<i.criticalChance;let a=0;if(i.def.penetrationChances!==void 0&&i.def.penetrationChances.length>0&&(a=Math.max(Math.min(i.def.penetrationChances[0],100),0)),l>0){if(F(e,n,l,1,s?i.criticalType:void 0,!1,o,i.disruption,i.spectrum,i.overflow,i.damageType,i.salvage,a,i.guided),i.def.name==="Core Stripper"&&n.coreIntegrity>0&&!n.immunities.includes(z.Dismemberment)&&M(0,99)<33)for(let d=0;d<n.parts.length;d++){const t=n.parts[0];t.integrity*=M(25,75)/100,k(e,!1,0,t,0,"Entropic","CriticalRemove"),n.coreIntegrity=0}if(r(n))return!0}}if(i.explosionType!=null){let l=M(i.explosionMin,i.explosionMax);l=N(n,l,i.explosionType);const o=M(i.explosionChunksMin,i.explosionChunksMax);if(l>0&&(F(e,n,l,o,void 0,!0,!1,i.explosionDisruption,0,!0,i.explosionType,i.salvage,0,i.guided),r(n)))return!0}}}return!1}function le(e){return e===void 0?0:re[e]}function w(e){const i=e.offensiveState,r=e.botState;let n=0;const y=r.def.movement;(y.includes("Hovering")||y.includes("Flying"))&&(n-=10);const C=T(r.defensiveState.avoid);C!=null&&(n-=C.chance),i.analysis&&(n+=5);let l=!1;if(i.melee){for(let s=0;s<K.length;s++)n+=i.meleeAnalysis[s]*K[s];let o=0;for(let s=i.forceBoosters.length-1;s>=0;s--)i.forceBoosters[s]==2?(n-=1.5*G[s],o+=2):i.forceBoosters[s]==1&&(n-=G[s]*o==0?1:.5,o+=1)}else{n+=i.distance<6?(6-i.distance)*3:0;const o=i.specialBonus;e.tus>=o.tus&&(n+=o.bonus,l=o.recoilNegated);const s=T(r.defensiveState.rangedAvoid);s!=null&&(n-=s.avoid)}e.actionNum===0?n+=e.offensiveState.action1Accuracy:e.actionNum===1?n+=e.offensiveState.action2Accuracy:n+=10,r.sieged&&(n+=10),r.running&&(r.parts.find(o=>o.def.type==="Leg")!==void 0&&(n-=5*r.runningMomentum),n-=r.runningEvasion);for(const o of e.weapons){if(o.guided){o.accuracy=100;return}let s=o.baseAccuracy+n;!i.melee&&!l&&(s-=i.recoil-se(o.def,i.recoilReduction));const a=i.melee?ie:ee;o.accuracy=Math.min(a,Math.max(s,b))}}export{ue as L,Q as a,se as b,ge as c,le as d,Ae as e,ne as f,Ce as g,me as h,ve as i,pe as j,he as m,ye as s,Z as v};
