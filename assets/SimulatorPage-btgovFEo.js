import{v as mo,j as o,D as Ke,u as ho,r as H,c as De,S as Fe,b as h,z as U,d as _,B as Z,a as po,f as p,E as fo,g as vo,e as bo,p as go}from"./index-ClX8gOL2.js";import{L as Le}from"./lz-string-BF2BSa0E.js";import{u as Ce,I as yo,C as xo}from"./ItemPopover-DcpOXOMf.js";import{a as Co,s as jo,b as wo,m as Ee,c as ze,d as Ie,i as To,e as Mo,v as No,g as Ao,f as ko,h as Bo,j as We}from"./simulatorCalcs-z_2Wc7s5.js";import{S as Ro,c as Do,a as J,b as Fo,d as Eo,e as zo,C as Io,n as Wo,p as qo,o as Vo,L as Ko,q as Lo,i as Oo,h as Go}from"./chartColors-BIIcIckU.js";import{u as Oe}from"./BotDetails-fTPk40MT.js";import{B as Uo}from"./BotPopover-ClxdkwnY.js";/* empty css              */import"./items-RjbLE1iR.js";import"./bots-BVO9WYp3.js";import"./lore-08CTWJsY.js";Io.register(Wo,qo,Vo,Ko,Lo,Oo,Go);function qe({chartTitle:e,values:t,backgroundColors:a,borderColors:r,isPercentage:u,stepSize:m,xLabel:f,yLabel:M}){const b=mo(),s=Math.max(...t.map(d=>Math.max(...d.values.map(B=>B.x))));return o.jsx(Ro,{data:Ho(t,a,r),datasetIdKey:"id",options:_o(e,u,m,b,f,M,s),plugins:[Do]})}function Ho(e,t,a){return{datasets:e.map((r,u)=>({backgroundColor:t[u],borderColor:a[u],data:r.values,fill:"start",id:r.id||r.label,label:r.label,pointRadius:0,pointHitRadius:25,showLine:!0,stepped:"before"}))}}function _o(e,t,a,r,u,m,f){return{animation:{duration:300},color:J,maintainAspectRatio:!1,plugins:{chartCanvasBackgroundColor:{color:r==="Cogmind"?Eo:zo},legend:{labels:{font:{size:16}}},title:{color:J,font:{size:24},display:!0,text:e}},scales:{x:{border:{display:!1},min:0,max:f,grid:{display:!1},ticks:{color:J,stepSize:a},title:{color:J,display:u!==void 0,font:{size:24},text:u}},y:{border:{display:!1},max:t?100:void 0,min:t?0:void 0,grid:{color:Fo},ticks:{callback:t?(M,b,s)=>M+"%":void 0,color:J},title:{color:J,display:m!==void 0,font:{size:24},text:m}}}}}function le(e){return e<=.25?"lootbox-color-red":e<=.5?"lootbox-color-orange":e<=.75?"lootbox-color-yellow":"lootbox-color-green"}function fe(e){return e<=.25?"lootbox-color-green":e<=.5?"lootbox-color-yellow":e<=.75?"lootbox-color-orange":"lootbox-color-red"}function $o({bot:e,lootState:t}){const a=Ce(),r=t.matterDrop/t.numKills,u=t.matterBlasted/t.numKills,m=u>0;return o.jsxs("div",{className:"loot-box",children:[o.jsxs("div",{className:"loot-box-part-name-container",children:[o.jsx("span",{children:"Matter ["}),o.jsx("img",{src:Ke(a.getItem("Matter"))}),o.jsx("span",{children:"]"})]}),o.jsxs("div",{className:"loot-box-content-grid",children:[o.jsx("span",{children:"Avg. Death Drop"}),o.jsxs("span",{className:le(r/e.salvageHigh),children:[r.toFixed(1),"/",e.salvagePotential]}),m&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"Avg. Blasted Off"}),o.jsx("span",{children:u.toFixed(1)})]})]})]})}function So({itemLootState:e,numKills:t,showCorruption:a,showCriticals:r,showMelted:u}){const m=e.numDrops/t*100,f=e.totalIntegrity>0?e.totalIntegrity/e.numDrops:0,M=e.totalCorruptionPercent/t,b=e.totalFried/t*100,s=e.totalCritRemoves>0?e.totalCritRemoves/e.numDrops*100:0,d=e.totalMelted>0?e.totalMelted/t*100:0,B=[...e.integrityDrops];B.sort();const I=B.length===0?0:B[Math.floor(B.length/2)];return o.jsxs("div",{className:"loot-box",children:[o.jsxs("div",{className:"loot-box-part-name-container",children:[o.jsxs("span",{children:[e.item.name," ["]}),o.jsx("img",{src:Ke(e.item)}),o.jsx("span",{children:"]"})]}),o.jsxs("div",{className:"loot-box-content-grid",children:[o.jsx("span",{children:"Drop Rate"}),o.jsxs("span",{className:le(m/70),children:[m.toFixed(1),"%"]}),o.jsx("span",{children:"Average Integrity"}),o.jsxs("span",{className:le(f/e.item.integrity),children:[f.toFixed(1),"/",e.item.integrity]}),o.jsx("span",{children:"Median Integrity"}),o.jsxs("span",{className:le(I/e.item.integrity),children:[I,"/",e.item.integrity]}),a&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"Average Corruption"}),o.jsxs("span",{className:fe(M/7.5),children:[M.toFixed(1),"%"]}),o.jsx("span",{children:"Fried Rate"}),o.jsxs("span",{className:fe(b/40),children:[b.toFixed(1),"%"]})]}),r&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"Crit Off Rate"}),o.jsxs("span",{children:[s.toFixed(1),"%"]})]}),u&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"Melted rate"}),o.jsxs("span",{className:fe(d/40),children:[d.toFixed(1),"%"]})]})]})]})}const ve=[{value:"Stand/Fight"},{value:"Unpowered/Dormant"},{value:"Unpowered 10 Turns",tooltip:"The bot is unpowered initially and will wake up 10 turns after being hit in the core. Useful for a particular spoiler bot."},{value:"Siege/Fight"},{value:"Already Sieged/Fight"},{value:"Shield/Fight"},{value:"Already Shielded/Fight"},{value:"Running"},{value:"Run When Hit"}],Yo=[{value:"Ranged"},{value:"Melee"}],be=[{value:"None",label:"No damage reduction"},{value:"Remote Shield",label:"Remote Shield (25%)"},{value:"Stasis Trap",label:"Stasis Trap (25%)"},{value:"Phase Wall",label:"Phase Wall (50%)"},{value:"Remote Force Field",label:"Remote Force Field (50%)"},{value:"Stasis Bubble",label:"Stasis Bubble (50%)"}],je=[{value:"Kill"},{value:"Kill or Core Disrupt"},{value:"Kill or No Power"},{value:"Kill or No Weapons"}],Ge=[...je];Ge.push({value:"Tele",label:"Architect Tele (80% integrity, 1 weapon, or 1 prop)"});const Ue=[...je];Ue.push({value:"Kill or No TNC"});const ge=[{value:"No Special"},{value:"In Siege Mode"},{value:"In High Siege Mode"},{value:"In Martial Mode"},{value:"Entering Siege Mode"},{value:"Entering High Siege Mode"},{value:"Entering Martial Mode"}],ye=[{value:"None"},{value:"First Only"},{value:"All"}],Qo=[{value:"Volleys"},{value:"Time"}],P=[{value:"No"},{value:"Yes"}],Xo=["Impact Weapon","Piercing Weapon","Slashing Weapon","Special Melee Weapon"],Jo=["Ballistic Cannon","Ballistic Gun","Energy Cannon","Energy Gun","Launcher","Special Weapon"],Zo=["Core Cannon","Core Stripper","Modified Sigix Sheargun","Sigix Broadsword","Sigix Shearcannon","Sigix Sheargun"];function Po({disabled:e,i:t,pageState:a,updatePageState:r,weaponInfo:u,weaponItem:m,weaponOptions:f}){let M;const b=a.weaponState[t];return m.overloadStability?M=o.jsx(_,{label:"Overload",disabled:e,buttons:P,tooltip:"Whether to fire the weapon as overloaded (double damage). Does not take into account effects of additional heat generation or stability-related effects.",selected:b.overload||"No",onValueChanged:s=>{const d=[...a.weaponState];d[t]={...b,overload:s},r({...a,weaponState:d})}}):Zo.includes(m.name)?M=o.jsx(_,{label:"Exoskeleton",disabled:e,buttons:P,tooltip:"Whether a Sigix Exoskeleton is equipped (double damage on non-AOE Sigix weaponry).",selected:b.exo||"No",onValueChanged:s=>{const d=[...a.weaponState];d[t]={...b,exo:s},r({...a,weaponState:d})}}):m.studyable&&(M=o.jsx(_,{label:"Study",disabled:e,buttons:P,tooltip:"Whether the study for the part has been obtained (+10% accuracy).",selected:b.study||"No",onValueChanged:s=>{const d=[...a.weaponState];d[t]={...b,study:s},r({...a,weaponState:d})}})),o.jsxs("div",{className:"weapon-row",children:[o.jsxs("div",{className:"flex",children:[o.jsx(U,{id:u.id.toString(),isDisabled:e,className:"weapon-select",label:"Weapon",tooltip:"Name of an equipped weapon to fire.",options:f,value:f.find(s=>s.value===u.name),onChange:s=>{const d=[...a.weaponState];d[t]={id:b.id,name:s.value,number:b.number},r({...a,weaponState:d})}}),o.jsx(yo,{item:m,tooltip:"Show details about the part.",text:"?",showWikiLink:!0})]}),o.jsx(h,{label:"Number",disabled:e,className:"flex-1-1",value:u.number||"",onChange:s=>{const d=[...a.weaponState];d[t]={...b,number:s},r({...a,weaponState:d})},placeholder:"1",tooltip:"How many weapons of this type to have equipped."}),M,o.jsx(Z,{tooltip:"Deletes this weapon.",disabled:e,onClick:()=>{const s=[...a.weaponState];s.splice(s.indexOf(u),1),r({...a,weaponState:s})},children:"X"})]})}function ea({pageState:e,simulationInProgress:t,updatePageState:a}){var L;const r=Oe(),u=Ce(),m=ho(),f=H.useMemo(()=>r.getAllBotsSorted().filter(n=>De(n.spoiler,m)).map(n=>({value:n.name})),[m]),M=H.useMemo(()=>u.getAllItemsSorted().filter(n=>{if(!De(n.spoiler,m))return!1;if(e.combatType==="Melee"){if(!Xo.includes(n.type))return!1}else if(!Jo.includes(n.type))return!1;if(n.damageType!=="Special")return!0}).map(n=>({value:n.name})),[m,e]),b=r.getBotOrNull(e.botName||"")===null?"G-34 Mercenary":e.botName,s=r.getBot(b);let d;s.name==="Architect"?d=Ge:s.name==="A-15 Conveyor"?d=Ue:d=je;const B=o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"page-input-group",children:[o.jsx(Fe,{label:"Melee Analysis Suites",tooltip:"The number of each type of Melee Analysis Suites equipped. Provides bonus accuracy and a minimum damage increase, but not more than the maximum damage for a weapon."}),o.jsx(h,{label:"Standard",disabled:t,value:e.baseMas||"",onChange:n=>a({...e,baseMas:n}),placeholder:"0",tooltip:"The amount of standard Melee Analysis Suites equipped. Each provides 5% accuracy and a minimum damage increase of 2."}),o.jsx(h,{label:"Imp.",disabled:t,value:e.impMas||"",onChange:n=>a({...e,impMas:n}),placeholder:"0",tooltip:"The amount of Improved Melee Analysis Suites equipped. Each provides 6% accuracy and a minimum damage increase of 3."}),o.jsx(h,{label:"Adv.",disabled:t,value:e.advMas||"",onChange:n=>a({...e,advMas:n}),placeholder:"0",tooltip:"The amount of Advanced Melee Analysis Suites equipped. Each provides 8% accuracy and a minimum damage increase of 4."}),o.jsx(h,{label:"Exp.",disabled:t,value:e.expMas||"",onChange:n=>a({...e,expMas:n}),placeholder:"0",tooltip:"The amount of Experimental Melee Analysis Suites equipped. Each provides 12% accuracy and a minimum damage increase of 6."}),o.jsx(h,{label:"Targeting",disabled:t,value:e.targeting||"",onChange:n=>a({...e,targeting:n}),placeholder:"0%",tooltip:"The amount of targeting bonus from utilities such as the Weapon Mount. Applied directly to all weapons."})]}),o.jsxs("div",{className:"page-input-group",children:[o.jsx(Fe,{label:"Force Boosters",tooltip:"The number of each type of Force Booster equipped. Provides a bonus to maximum damage and a decrease to accuracy. These utilities half_stack, so only the 2 highest ratings count."}),o.jsx(h,{label:"Standard",disabled:t,value:e.baseForceBoosters||"",onChange:n=>a({...e,baseForceBoosters:n}),placeholder:"0",tooltip:"The amount of standard Force Boosters equipped. Provides a maximum damage increase of 20% and a melee accuracy penalty of 4%."}),o.jsx(h,{label:"Imp.",disabled:t,value:e.impForceBoosters||"",onChange:n=>a({...e,impForceBoosters:n}),placeholder:"0",tooltip:"The amount of Improved Force Boosters equipped. Provides a maximum damage increase of 30% and a melee accuracy penalty of 6%."}),o.jsx(h,{label:"Adv.",disabled:t,value:e.advForceBoosters||"",onChange:n=>a({...e,advForceBoosters:n}),placeholder:"0",tooltip:"The amount of Advanced Force Boosters equipped. Provides a maximum damage increase of 40% and a melee accuracy penalty of 8%."}),m==="Redacted"&&o.jsx(h,{label:"Exp.",disabled:t,value:e.expForceBoosters||"",onChange:n=>a({...e,expForceBoosters:n}),placeholder:"0",tooltip:"The amount of Experimental Force Boosters equipped. Provides a maximum damage increase of 50% and a melee accuracy penalty of 10%."})]}),o.jsxs("div",{className:"page-input-group",children:[o.jsx(h,{label:"Initial Momentum",disabled:t,value:e.initialMomentum||"",onChange:n=>a({...e,initialMomentum:n}),placeholder:"0",tooltip:"The momentum bonus from movement for the first attack. This should be 0-3."}),o.jsx(h,{label:"Bonus Momentum",disabled:t,value:e.bonusMomentum||"",onChange:n=>a({...e,bonusMomentum:n}),placeholder:"0",tooltip:"The amount of bonus momentum from Reaction Control Systems (Always 0 or 1, no_stack)."}),o.jsx(h,{label:"Speed",disabled:t,value:e.speed||"",onChange:n=>a({...e,speed:n}),placeholder:"100",tooltip:"The speed of Cogmind. Higher speed provides increased momentum bonus damage."}),o.jsx(U,{className:"sneak-attack-select",isDisabled:t,label:"Sneak Attacks",isSearchable:!1,tooltip:"Whether to perform sneak attacks or not. Sneak attacks provide a base hit chance of 120% and double damage.",options:ye,value:ye.find(n=>n.value===e.sneakAttacks)||ye[0],onChange:n=>{a({...e,sneakAttacks:n.value})}}),o.jsx(h,{label:"Pre-Salvage",disabled:t,value:e.preSalvage||"",onChange:n=>a({...e,preSalvage:n}),placeholder:"0",tooltip:"The amount of salvage applied to this bot before the simulation started. Can be used to simulate hitting a bot a few times with + salvage before aiming to kill the bot to increase loot drops."})]})]}),I=o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"page-input-group",children:[o.jsx(h,{label:"Targeting",disabled:t,value:e.targeting||"",onChange:n=>a({...e,targeting:n}),placeholder:"0%",tooltip:"The amount of targeting bonus from Targeting Computers or similar utilities (stacks). For reference, Base is 5%, Improved is 6%, Advanced is 8%, Experimental is 12%."}),o.jsx(h,{label:"Recoil Reduction",disabled:t,value:e.recoilReduction||"",onChange:n=>a({...e,recoilReduction:n}),placeholder:"0",tooltip:m=="Redacted"?"The amount of recoil reduction. Each tread slot has 1 recoil reduction, Recoil Stabilizers have 4, Adv. Recoil Stabilizers have 6, and Cep. Recoil Nullifiers have 99.":"The amount of recoil reduction. Each tread slot has 1 recoil reduction, Recoil Stabilizers have 4 and Adv. Recoil Stabilizers have 6."}),o.jsx(h,{label:"Distance",disabled:t,value:e.distance||"",onChange:n=>a({...e,distance:n}),placeholder:"6+",tooltip:"The distance from the target. Each tile closer than 6 tiles away provides 3% accuracy up to 15% at 1 tile away."}),o.jsx(U,{className:"special-select",isDisabled:t,label:"Special Prop",isSearchable:!1,tooltip:"The type of special propulsion mode active (if any). Siege mode removes all recoil and adds a 15% (standard) or 25% (high) bonus to targeting. Martial mode only removes all recoil.",options:ge,value:ge.find(n=>n.value===e.special)||ge[0],onChange:n=>{a({...e,special:n.value})}})]}),o.jsxs("div",{className:"page-input-group",children:[o.jsx(h,{label:"Particle Charging",disabled:t,value:e.particleCharger||"",onChange:n=>a({...e,particleCharger:n}),placeholder:"0%",tooltip:"The bonus from Particle Charger/Accelerators that are equipped (if any). Increases damage of energy gun/cannon weapons (half_stack). Base charger starts at 15%, going to 20%, 25%, 30%, 40%, and 50%."}),o.jsx(h,{label:"Kinecellerator",value:e.kinecellerator||"",disabled:t,onChange:n=>a({...e,kinecellerator:n}),placeholder:"0%",tooltip:m==="Redacted"?"The bonus from a Kinecellerator that's equipped (if any). Increases minimum damage of kinetic gun/cannon weapons. Base Kinecellerator starts at 30%, Improved at 40%, Advanced at 50%, and Experimental at 66%.":"The bonus from a Kinecellerator that's equipped (if any). Increases minimum damage of kinetic gun/cannon weapons. Base Kinecellerator starts at 30%, Improved at 40%, and Advanced at 50%."}),o.jsx(h,{label:"Weapon Cycling",disabled:t,value:e.weaponCycling||"",onChange:n=>a({...e,weaponCycling:n}),placeholder:"0%",tooltip:m==="Redacted"?"The percentage of Weapon Cycling or similar utilities that are equipped (if any). Decreases overall volley time. Stacks up to 30%, though a Mni. Quantum Capacitor can go up to 40%, and a Quantum Capacitor or Launcher Loader can go up to 50%.":"The percentage of Weapon Cycling or similar utilities that are equipped (if any). Decreases overall volley time. Stacks up to 30%, though a Quantum Capacitor or Launcher Loader can go up to 50%."}),o.jsx(h,{label:"Salvage Targeting",disabled:t,value:e.salvageTargeting||"",onChange:n=>a({...e,salvageTargeting:n}),placeholder:"0",tooltip:m==="Redacted"?"The bonus of Salvage Targeting Computers that are equipped (if any). Increase salvage generated from Gun-type weapons that fire a single projectile (stacks). Base starts at +1, Improved is +2, Advanced is +3, Makeshift is +4, and Experimental is +5.":"The bonus of Salvage Targeting Computers that are equipped (if any). Increase salvage generated from Gun-type weapons that fire a single projectile (stacks). Base starts at +1, Improved is +2, Advanced is +3, and Makeshift is +4."}),m!=="None"&&o.jsx(h,{label:"Partition Strike Chips",disabled:t,value:e.partitionStrikeChips||"",onChange:n=>a({...e,partitionStrikeChips:n}),placeholder:"0",tooltip:"The number of Partition Strike Chips that are equipped. Partition Strike Chips are like a +3 Salvage Targeting Computer that also works on cannons."})]})]}),j=o.jsxs(o.Fragment,{children:[(L=e.weaponState)==null?void 0:L.map((n,W)=>{const D=u.getItem(n.name);return o.jsx(Po,{disabled:t,pageState:e,updatePageState:a,weaponItem:D,weaponInfo:n,weaponOptions:M,i:W},n.id)}),o.jsx("div",{className:"new-weapon-row",children:o.jsx(U,{label:"Weapon",isDisabled:t,className:"weapon-select",tooltip:"Name of an equipped weapon to fire.",options:M,controlShouldRenderValue:!1,onChange:n=>{const W=[...e.weaponState||[]],D=Math.max(0,...W.map(R=>R.id+1));W.push({name:n.value,id:D}),a({...e,weaponState:W})}})})]});return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"page-input-group",children:[o.jsx(_,{label:"Combat Type",disabled:t,buttons:Yo,className:"flex-grow-0",tooltip:"The type of weapons to display. Melee and ranged weapons also have unique utilities and other settings.",selected:e.combatType,onValueChanged:n=>{a({...e,weaponState:[],combatType:n})}}),o.jsx(h,{label:"Num Fights",disabled:t,value:e.numSimulations||"",onChange:n=>a({...e,numSimulations:n}),placeholder:"100,000",tooltip:"The number of fights to simulate. High numbers will increase result accuracy but also increase time to calculate."}),o.jsx(U,{className:"enemy-behavior-select",isDisabled:t,label:"Enemy Behavior",tooltip:"The behavior of the enemy when engaged in combat. The default for most hostile combat bots is Stand/Fight, and the behavior of most non-combat bots will be RUn When Hit.",isSearchable:!1,options:ve,value:ve.find(n=>n.value===e.enemyBehavior)||ve[0],onChange:n=>{a({...e,enemyBehavior:n.value})}}),o.jsx(Z,{tooltip:"Resets all values to their default state",disabled:t,className:"flex-grow-0",onClick:()=>a({}),children:"Reset"})]}),o.jsxs("div",{className:"page-input-group",children:[o.jsxs("div",{className:"enemy-group",children:[o.jsx(U,{label:"Enemy",className:"enemy-select",isDisabled:t,tooltip:"The name of the enemy bot to fight.",options:f,value:f.find(n=>n.value===b),onChange:n=>{a({...e,botName:n.value})}}),o.jsx(Uo,{bot:s,text:"?",tooltip:"Show details about the bot."})]}),o.jsx(_,{label:"Analysis",buttons:P,disabled:t,tooltip:"Does Cogmind have the analysis for this bot? An analysis provides bonuses of 5% accuracy and 10% damage.",selected:e.analysis||"No",onValueChanged:n=>{a({...e,analysis:n})}}),o.jsx(U,{label:"Damage Reduction",isDisabled:t,className:"damage-reduction-select",tooltip:"The type of external damage reduction (if any) for the enemy. Note: this does not stack with personal damage reduction utilities.",isSearchable:!1,options:be,value:be.find(n=>n.value===e.damageReduction)||be[0],onChange:n=>{a({...e,damageReduction:n.value})}})]}),o.jsxs("div",{className:"page-input-group",children:[o.jsx(h,{label:"Corruption",disabled:t,value:e.corruption||"",onChange:n=>a({...e,corruption:n}),placeholder:"0%",tooltip:"The amount of corruption that Cogmind currently has. Corruption reduces accuracy by 1% for every 3% of corruption."}),o.jsx(h,{label:"Actions Since Moving",disabled:t,value:e.actionsSinceMoving||"",onChange:n=>a({...e,actionsSinceMoving:n}),placeholder:"2+",tooltip:"The number of actions performed since Cogmind last moved. For melee, there is a +10% accuracy bonus gained after not moving for 2 turns. For ranged, there is an additional -10% penalty if the most recent action was a move. Basically, 0 turns since moving = -10%, 1 turn = 0%, 2 turns = 10%."}),o.jsx(_,{label:"On Legs",disabled:t,buttons:P,tooltip:"Is Cogmind on legs? If so, the number of tiles run in a row provide an additional 5% penalty per tile moved.",selected:e.onLegs||"No",onValueChanged:n=>{a({...e,onLegs:n})}}),o.jsx(h,{label:"Tiles Run",disabled:t,value:e.tilesRun||"",onChange:n=>a({...e,tilesRun:n}),placeholder:"0",tooltip:"The number of tiles Cogmind has been running for if on legs. There is a -5% penalty per tile moved for ranged weapons, up to a maximum of -15%."})]}),e.combatType==="Melee"?B:I,o.jsxs("div",{className:"page-input-group last-pre-weapon-row",children:[o.jsx(h,{label:"Armor Integrity Analyzer",disabled:t,value:e.armorIntegrityAnalyzer||"",onChange:n=>a({...e,armorIntegrityAnalyzer:n}),placeholder:"0%",tooltip:"The type of armor integrity analyzer that's equipped (if any). Adds a chance of bypassing enemy armor. Values are 30% for basic, 40% for Improved, and 50% for Experimental."}),o.jsx(h,{label:"Core Analyzer",disabled:t,value:e.coreAnalyzer||"",onChange:n=>a({...e,coreAnalyzer:n}),placeholder:"0%",tooltip:"The bonus from one or more Core Analyzers that are equipped (if any). Increases core exposure by the specific amount (half_stack). Base Analyzer is 6% and Experimental is 8%, for a maximum of 12%."}),o.jsx(h,{label:"Target Analyzer",disabled:t,value:e.targetAnalyzer||"",onChange:n=>a({...e,targetAnalyzer:n}),placeholder:"0%",tooltip:"The bonus from one or more Target Analyzers that are equipped (if any). Increases critical hit % chance for weapons with a critical hit (half_stack). Base Analyzer is 5%, Improved is 6%, Advanced is 8%, and Experimental is 10%."}),e.combatType==="Melee"&&o.jsxs(o.Fragment,{children:[o.jsx(h,{label:"Actuator",disabled:t,value:e.actuator||"",onChange:n=>a({...e,actuator:n}),placeholder:"0%",tooltip:"The bonus from actuator that's equipped (if any). Decreases volley time by a fixed percentage. Microactuators are 20%, Nanoacturators are 30%, and Femtoactuators are 50%."}),o.jsx(h,{label:"Actuator Array",disabled:t,value:e.actuatorArray||"",onChange:n=>a({...e,actuatorArray:n}),placeholder:"0%",tooltip:"The bonus from one or two actuator arrays equipped. Increases followup chance for all weapons (half_stack). Base Actuator Array is 10%, Improved is 12%, Advanced is 16%, and Experimental is 20%."})]})]}),j,o.jsxs("div",{className:"page-input-group",children:[o.jsx(_,{label:"X-Axis",disabled:t,className:"flex-grow-0",buttons:Qo,tooltip:"The type of x-axis to show on the graph.",selected:e.xAxis||"Volleys",onValueChanged:n=>{a({...e,xAxis:n})}}),o.jsx(_,{label:"Show Loot",disabled:t,className:"flex-grow-0",buttons:P,tooltip:"Whether or not to show estimated loot drops. Expected matter and part drop rate chance and integrity are shown. Crit off rate shows the % of the drop rate that was caused due to blast, sever, or sunder critical hits, if applicable.",selected:e.showLoot||"No",onValueChanged:n=>{a({...e,showLoot:n})}}),o.jsx(U,{label:"End Condition",isDisabled:t,tooltip:"The scenario to occur before the simulation is ended.",isSearchable:!1,options:d,value:d.find(n=>n.value===e.endCondition)||d[0],onChange:n=>{a({...e,endCondition:n.value})}})]})]})}const Ve=["rgba(228, 26, 28, .8)","rgba(55, 126, 184, .8)","rgba(36, 192, 36, .8)","rgba(152, 78, 163, .8)","rgba(255, 127, 0, .8)","rgba(255, 255, 51, .8)","rgba(243, 145, 146, .8)","rgba(145, 187, 222, .8)","rgba(135, 232, 135, .8)","rgba(202, 159, 209, .8)","rgba(255, 194, 133, .8)","rgba(163, 163, 0, .8)"];let xe=!1;function oa(){const e=bo(),t=go(e,{});let a;if(t.weaponState!==void 0){const r=Le.decompressFromEncodedURIComponent(t.weaponState);if(r!==null){const u=JSON.parse(r);Array.isArray(u)&&(a=u)}}return{...t,weaponState:a}}const aa=/Core Regeneration \((\d*)\)/;function na(e){const t=e.traits;for(let a=0;a<t.length;a++){const r=aa.exec(t[a]);if(r!=null)return parseInt(r[1])}return 0}const ta=/Part Regeneration \((\d*)\)/;function sa(e){const t=e.traits;for(let a=0;a<t.length;a++){const r=ta.exec(t[a]);if(r!=null)return parseInt(r[1])}return 0}function ia(e){let t;if(e.weaponState&&e.weaponState.length>0){const a=JSON.stringify(e.weaponState);t=Le.compressToEncodedURIComponent(a)}return{...e,weaponState:t}}function la(e,t,a,r){const u=a.botName||"G-34 Mercenary",m=[];for(const l of a.weaponState??[]){const v=t.tryGetItem(l.name);if(v===void 0||v.slot!=="Weapon"){r(`Item ${l.name} is not a valid weapon, this is probably a bug.`);return}const i=p(l.number,1),C=l.overload==="Yes",k=l.exo==="Yes",Y=l.study==="Yes";for(let V=0;V<i;V++)m.push({def:v,overloaded:C||k,exo:k,study:Y})}if(m.length===0){r("There must be at least 1 weapon selected.");return}const f=[];let M=0;function b(l,v){const i=l.type==="Protection",C=l.type==="Treads",k=l.coverage??0,Y=l.type==="Leg"&&l.shield?2*k:k,V=i||C?2*k:k;let X=0;(l.slot==="Propulsion"||l.slot==="Utility")&&(X=l.energyUpkeep||0),f.push({armorAnalyzedCoverage:i?0:k,armorAnalyzedShieldedCoverage:i?0:Y,armorAnalyzedSiegedCoverage:i?0:V,coverage:k,def:l,energyUpkeep:X,integrity:v,initialIndex:M++,protection:i,selfDamageReduction:0,shieldedCoverage:Y,siegedCoverage:V})}const s=e.getBotOrNull(u);if(!s){r(`Bot ${u} is invalid, this is probably a bug.`);return}s.componentData.concat(s.armamentData).concat(s.componentOptionData.map(l=>l[0])).concat(s.armamentOptionData.map(l=>l[0])).forEach(l=>{for(let v=0;v<l.number;v++){const i=t.getItem(l.name);b(i,i.integrity)}});const d=s.coreCoverage,B=s.totalCoverage,I=s.coreIntegrity,j=d+f.reduce((l,v)=>l+v.armorAnalyzedCoverage,0),L=d+f.reduce((l,v)=>l+v.armorAnalyzedShieldedCoverage,0),n=d+f.reduce((l,v)=>l+v.armorAnalyzedSiegedCoverage,0),W=d+f.reduce((l,v)=>l+v.shieldedCoverage,0),D=d+f.reduce((l,v)=>l+v.siegedCoverage,0),R=a.enemyBehavior||"Stand/Fight",ee=R==="Unpowered/Dormant"||R==="Unpowered 10 Turns",se=Co(f,a.damageReduction||"None",ee);let Q=0;s.speed<100?Q=Math.trunc((100-s.speed)/5):Q=0;const re=R==="Already Shielded/Fight"&&f.find(l=>l.def.type==="Leg"&&l.def.shield)!==void 0,ce=R==="Already Sieged/Fight"&&f.find(l=>l.def.type==="Treads"&&l.def.siege!==void 0)!==void 0,de=p(a.preSalvage,0),oe={armorAnalyzedCoverage:j,armorAnalyzedShieldedCoverage:L,armorAnalyzedSiegedCoverage:n,behavior:R,coreCoverage:d,coreDisrupted:!1,coreIntegrity:I,coreRegen:na(s),corruption:0,def:s,defensiveState:se,destroyedParts:[],dormant:ee,energy:s.maxEnergy,energyGen:s.energyGeneration,externalDamageReduction:a.damageReduction||"None",heat:0,immunities:s.immunities,initialCoreIntegrity:I,mass:s.mass,maximumEnergy:s.maxEnergy,parts:f,partRegen:sa(s),resistances:s.resistances===void 0?{}:s.resistances,running:R==="Running",runningEvasion:Q,runningMomentum:R==="Running"?3:0,salvage:de,shielded:re,shieldedCoverage:W,sieged:ce,siegedCoverage:D,superfortressRegen:s.name==="Superfortress"?{nextRegenAttempt:0}:void 0,support:s.support,totalCoverage:B,tusToShield:R==="Shield/Fight"?400:0,tusToSiege:R==="Siege/Fight"?500:0};let ae=!1;const c=a.combatType==="Melee",N={bonus:0,recoilNegated:!1,tus:0},A=c?N:jo.get(a.special)||N,x=p(a.targeting,0),w=[p(a.baseMas,0),p(a.impMas,0),p(a.advMas,0),p(a.expMas,0)],y=[p(a.baseForceBoosters,0),p(a.impForceBoosters,0),p(a.advForceBoosters,0),p(a.expForceBoosters,0)];if(c){let l=2;for(let v=y.length-1;v>=0;v--)y[v]>l?(y[v]=l,l=0):l-=y[v]}let g=p(a.distance,6);g<=1&&(g=1);const T=p(a.recoilReduction,0),$=m.reduce((l,v)=>wo(v.def,T)+l,0),F=p(a.targetAnalyzer,0),q=p(a.salvageTargeting,0),O=p(a.partitionStrikeChips,0)*3,S=p(a.corruption,0),E=m.map((l,v)=>{const i=l.def;let C=0,k=0,Y,V=0,X=0,Re;if(i.damage!==void 0){if(i.damage.includes("-")){const K=i.damage.split("-");C=parseInt(K[0]),k=parseInt(K[1])}else C=parseInt(i.damage),k=C;if(i.type==="Ballistic Gun"||i.type==="Ballistic Cannon"){const K=p(a.kinecellerator,0);C=Math.trunc(C*(1+K/100)),C>k&&(k=C)}else if(c&&!l.exo){let K=0;for(let z=0;z<Ee.length;z++)K+=w[z]*Ee[z];C=Math.min(K+C,k);let he=0,pe=0;for(let z=y.length-1;z>=0;z--)y[z]==2?(he=1.5*We[z],pe+=2):y[z]==1&&(he+=We[z]*(pe==0?1:.5),pe+=1);k=Math.floor(k*(1+he))}Y=i.damageType}if(i.explosionDamage!==void 0){if(i.explosionDamage.includes("-")){const K=i.explosionDamage.split("-");V=parseInt(K[0]),X=parseInt(K[1])}else V=parseInt(i.explosionDamage),X=V;Re=i.explosionType}let ue;i.criticalType===xo.Meltdown?ue=i.critical:ue=i.critical===void 0||i.critical===0?0:i.critical+F;const ao=Math.trunc(S/4);let G=c?To:Mo;G+=x,ze.has(s.size)?G+=ze.get(s.size):console.log(`${u} has invalid size ${s.size}`),l.study&&(G+=10),i.targeting!==void 0&&(G+=i.targeting),G-=ao;const no=p(i.delay,0);c&&v!=0&&(G+=10);const to=i.disruption??0,so=i.explosionDisruption??0,io=Ie(i.spectrum),lo=Ie(i.explosionSpectrum),ro=i.minChunks??1,co=i.maxChunks??1;i.name==="Ram"&&(ae=!0);const uo=i.type==="Launcher"&&i.name!="Sigix Terminator"&&i.name!="Supercharged Sigix Terminator"&&i.name!="Vortex Catalyst Activator";let me=i.salvage??0;return q>0&&i.projectileCount==1&&(i.type==="Ballistic Gun"||i.type==="Energy Gun")&&(me+=q),O>0&&i.projectileCount===1&&(i.type==="Ballistic Gun"||i.type==="Ballistic Cannon"||i.type==="Energy Gun"||i.type==="Energy Cannon")&&(me+=O),{accelerated:i.type==="Energy Gun"||i.type==="Energy Cannon",accuracy:G,baseAccuracy:G,criticalChance:ue,criticalType:i.criticalType,damageMin:C,damageMax:k,damageType:Y,def:i,delay:no,disruption:to,exoBoosted:l.exo,explosionChunksMin:ro,explosionChunksMax:co,explosionDisruption:so,explosionMin:V,explosionMax:X,explosionSpectrum:lo,explosionType:Re,guided:i.waypoints!==void 0,isMissile:uo,numProjectiles:i.projectileCount,overflow:!i.type.includes("Gun"),overloaded:l.overloaded,salvage:me,spectrum:io,study:l.study}}),He=1+Math.max(p(a.particleCharger,0),0)/100,_e=p(a.armorIntegrityAnalyzer,0),$e=p(a.coreAnalyzer,0),Se=p(a.actuatorArray,0),we=[];if(c){const l=20+Se;E.forEach((v,i)=>{if(i!=0){let C=l+Math.trunc((E[0].delay-v.delay)/10);C=Math.min(C,100),C=Math.max(C,0),we.push(C)}})}const Ye=p(a.speed,100),Te=p(a.bonusMomentum,0),Me=p(a.initialMomentum,0),Qe=a.sneakAttacks||"None",Xe=Math.max(0,Math.min(99,p(a.actuator,0))),Je=Math.max(0,Math.min(99,p(a.weaponCycling,0))),Ne=1-(c?Xe:Je)/100,Ze=c?E[0].delay+No[1]:Ao(E.map(l=>l.def),Ne);let te,ie;const Ae=p(a.actionsSinceMoving,2);Ae==0?(te=c?0:-10,ie=0):Ae==1?(te=0,ie=10):(te=10,ie=10);const ke=a.onLegs==="Yes"?p(a.tilesRun,0):0;ke>0&&!c&&(te-=Math.min(ke,3)*5);const Be=[];for(const l of oe.parts)Be.push({item:l.def,integrityDrops:[],numDrops:0,totalCritRemoves:0,totalCorruptionPercent:0,totalFried:0,totalIntegrity:0,totalMelted:0});const Pe={numKills:0,items:Be,matterBlasted:0,matterDrop:0},eo={action1Accuracy:te,action2Accuracy:ie,armorAnalyzerChance:_e,analysis:a.analysis==="Yes",chargerBonus:He,coreAnalyzerChance:$e,corruption:S,distance:g,followupChances:we,forceBoosters:y,melee:c,meleeAnalysis:w,momentum:{bonus:Te,current:Te+Me,initial:Me},ramming:ae,recoil:$,recoilReduction:T,specialBonus:A,sneakAttack:!1,sneakAttackStrategy:Qe,speed:Ye,targetingComputerBonus:x,volleyTime:Ze,volleyTimeModifier:Ne},oo=a.endCondition||"Kill";return{actionNum:0,botState:oe,endCondition:oo,initialBotState:oe,killTus:{},killVolleys:{},lootState:Pe,offensiveState:eo,tus:0,weapons:E}}function ra(e,t){const a=e;return a==="analysis"&&t.analysis==="No"||a==="combatType"&&t.combatType==="Ranged"||a==="damageReduction"&&t.damageReduction==="None"||a==="endCondition"&&t.endCondition==="Kill"||a==="enemyBehavior"&&t.enemyBehavior==="Stand/Fight"||a==="onLegs"&&t.onLegs==="No"||a==="special"&&t.special==="No Special"||a==="xAxis"&&t.xAxis==="Volleys"}function Ta(){var ae;const[e,t]=po(),a=Oe(),r=Ce(),u=oa(),[m,f]=H.useState(!1),[M,b]=H.useState(""),[s,d]=H.useState(void 0),[B,I]=H.useState(""),[j,L]=H.useState({comparisonChartName:"",datasets:[]}),n=H.useRef(null);function W(c){const N=ia(c),A=vo("/simulator",N,ra);t(A,{replace:!0})}const D=p((ae=u.numSimulations)==null?void 0:ae.replace(",",""),1e5);let R,ee,se,Q;if(s!==void 0){let c,N,A,x;if(u.xAxis==="Time"?(c=`Time Units/Kill vs ${s.botName}`,A=s.cumulativeKillPerTuData,N=s.killPerTuData,x="Number of Time Units"):(c=`Volleys/Kill vs ${s.botName}`,A=s.cumulativeKillPerVolleyData,N=s.killPerVolleyData,x="Number of Volleys"),R=o.jsx("div",{className:"chart-container",children:o.jsx(qe,{backgroundColors:["rgba(0, 98, 0, 0.3)","rgba(96, 96, 96, .3)"],borderColors:["rgba(0, 196, 0, 1)","rgba(128, 128, 128, 1)"],chartTitle:c,isPercentage:!0,values:[{label:"Current volley kill %",values:N},{label:"Cumulative Kill %",values:A}],xLabel:x,yLabel:"Percent of Kills"})}),se=o.jsxs("div",{className:"page-input-group",children:[o.jsx(h,{label:"Dataset Name",value:B||"",onChange:w=>I(w),placeholder:"Enter dataset name",tooltip:"The name for this dataset when added to the custom comparison chart. Can be renamed once added."}),o.jsx(Z,{className:"flex-grow-0",onClick:()=>{const w={...j},y=new Array(Ve.length).fill(0);for(const F of j.datasets)y[F.colorIndex]+=1;let g=0,T;for(;T=y.indexOf(g),!(T>=0);)g+=1;const $=j.datasets.length===0?0:Math.max(...j.datasets.map(F=>F.id))+1;w.datasets=[...j.datasets,{colorIndex:T,data:s.comparisonData,id:$,name:B}],L(w),I("")},disabled:B==="",children:"Add To Comparison"})]}),u.showLoot==="Yes"){const w=s.lootState.items.find(T=>T.totalCorruptionPercent>0||T.totalFried>0)!==void 0,y=s.lootState.items.find(T=>T.totalCritRemoves>0)!==void 0,g=s.lootState.items.find(T=>T.totalMelted>0)!==void 0;ee=o.jsxs("div",{className:"loot-grid",children:[o.jsx($o,{bot:a.getBot(s.botName),lootState:s.lootState}),s.lootState.items.map((T,$)=>o.jsx(So,{itemLootState:T,numKills:s.lootState.numKills,showCorruption:w,showCriticals:y,showMelted:g},$))]})}}if(j.datasets.length>0){const c=[],N=[],A=[];for(const x of j.datasets)c.push("rgba(0, 0, 0, 0)"),N.push(Ve[x.colorIndex]),A.push({id:x.id.toString(),label:x.name,values:x.data});Q=o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"page-input-group",children:o.jsx(h,{label:"Chart Name",value:j.comparisonChartName||"",onChange:x=>L({...j,comparisonChartName:x}),placeholder:"Custom Comparison",tooltip:"The name for this dataset when added to the custom comparison chart. Can be renamed once added."})}),o.jsx("div",{className:"custom-dataset-groups",children:j.datasets.map((x,w)=>o.jsxs("div",{children:[o.jsx(fo,{onChange:y=>{const g=[...j.datasets];g[w]={...g[w],name:y},L({...j,datasets:g})},value:x.name}),o.jsx(Z,{onClick:()=>{const y=[...j.datasets];y.splice(w,1),L({...j,datasets:y})},children:"X"})]},x.id))}),o.jsx("div",{className:"chart-container",children:o.jsx(qe,{backgroundColors:c,borderColors:N,chartTitle:j.comparisonChartName||"Custom Comparison",isPercentage:!0,values:A,xLabel:"Number of Time Units",yLabel:"Percent of Kills"})})]})}function re(){let c=0;const N=performance.now();let A=N,x=A;const w=la(a,r,u,b);if(w===void 0){f(!1);return}function y(){for(;c<D;c++){if(xe)return;if(c%100===0){const g=performance.now();if(g-A>30){if(A=g,g-x>100){const T=(c*100/D).toFixed(1);n.current.innerHTML=`${String(T).padStart(4,"0")} % completed.`,x=g}setTimeout(y,0);break}}try{if(!ko(w)){b(`The simulation exceeded ${Bo} volleys and will likely never kill.`),f(!1);return}}catch(g){console.log(g),b("The simulation encountered an unexpected error, this is a bug."),f(!1);return}}if(c>=D){let g=performance.now()-N;g/=1e3,b(`Completed in ${g.toFixed(2)} seconds.`),f(!1),de(w)}}xe=!1,f(!0),y()}function ce(){xe=!0,f(!1),b("Simulation cancelled"),n.current.innerHTML="Simulation cancelled"}function de(c){function N(F,q,O,S){const E=F.filter(ne=>q[ne]/D>Math.pow(10,-2-O)).map(ne=>({x:parseInt(ne),y:Math.trunc(q[ne]/D*Math.pow(10,2+O))/Math.pow(10,O)}));return E.length<5&&E.push({x:E[E.length-1].x+S,y:0}),E}function A(F){const q=[];let O=0;return F.forEach(S=>{O+=S.y,q.push({x:S.x,y:Math.trunc(O*100)/100})}),q}const x=Object.keys(c.killTus);x.sort((F,q)=>parseFloat(F)-parseFloat(q));const w=A(N(x,c.killTus,c.offensiveState.melee?3:1,100)),y=N(Object.keys(c.killVolleys),c.killVolleys,1,1),g=N(x,c.killTus,c.offensiveState.melee?3:1,c.offensiveState.volleyTime),T=A(y),$=A(g);d({botName:u.botName||"G-34 Mercenary",comparisonData:w,cumulativeKillPerTuData:$,cumulativeKillPerVolleyData:T,killPerTuData:g,killPerVolleyData:y,lootState:c.lootState,volleyTime:c.offensiveState.volleyTime})}const oe=m?o.jsx(Z,{className:"simulate-button",tooltip:"Cancels the running simulation",onClick:ce,children:"Cancel"}):o.jsx(Z,{className:"simulate-button",tooltip:"Run the simulation",onClick:re,children:"Simulate"});return o.jsxs("div",{className:"page-content",children:[o.jsx(ea,{pageState:u,simulationInProgress:m,updatePageState:W}),o.jsxs("div",{className:"simulate-row",children:[oe,o.jsx("label",{ref:n,className:"status-text",children:M})]}),R,se,ee,Q]})}export{Ta as default,na as getCoreRegen,sa as getPartRegen};
